<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>University AI Helper</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chat-container::-webkit-scrollbar {
            width: 4px;
        }
        .chat-container::-webkit-scrollbar-thumb {
            background-color: #4a5568;
            border-radius: 20px;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100">

    <div id="app" class="flex h-screen antialiased">

        <!-- Auth Screen -->
        <div id="auth-screen" class="w-full max-w-md m-auto bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8">
            <h1 class="text-3xl font-bold text-center mb-6 text-indigo-600 dark:text-indigo-400">University AI Helper</h1>
            <div id="auth-form-container">
                <!-- Login Form -->
                <form id="login-form" class="space-y-6">
                    <h2 class="text-2xl font-semibold text-center">Login</h2>
                    <div>
                        <label for="login-email" class="text-sm font-medium">Email</label>
                        <input id="login-email" type="email" required class="w-full p-3 mt-1 bg-gray-200 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="login-password" class="text-sm font-medium">Password</label>
                        <input id="login-password" type="password" required class="w-full p-3 mt-1 bg-gray-200 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <p id="login-error" class="text-red-500 text-sm hidden"></p>
                    <button type="submit" class="w-full bg-indigo-600 text-white p-3 rounded-md font-semibold hover:bg-indigo-700 transition-colors">Login</button>
                    <p class="text-center text-sm">Don't have an account? <a href="#" id="show-signup" class="text-indigo-500 hover:underline">Sign up</a></p>
                </form>

                <!-- Signup Form -->
                <form id="signup-form" class="space-y-6 hidden">
                    <h2 class="text-2xl font-semibold text-center">Sign Up</h2>
                    <div>
                        <label for="signup-email" class="text-sm font-medium">Email</label>
                        <input id="signup-email" type="email" required class="w-full p-3 mt-1 bg-gray-200 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="signup-password" class="text-sm font-medium">Password</label>
                        <input id="signup-password" type="password" required class="w-full p-3 mt-1 bg-gray-200 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                     <p id="signup-error" class="text-red-500 text-sm hidden"></p>
                    <button type="submit" class="w-full bg-indigo-600 text-white p-3 rounded-md font-semibold hover:bg-indigo-700 transition-colors">Sign Up</button>
                    <p class="text-center text-sm">Already have an account? <a href="#" id="show-login" class="text-indigo-500 hover:underline">Login</a></p>
                </form>
            </div>
        </div>

        <!-- Chat Screen -->
        <div id="chat-screen" class="hidden w-full h-full md:flex">
            <!-- Sidebar -->
            <div id="sidebar" class="w-1/4 bg-gray-200 dark:bg-gray-800 p-4 flex flex-col">
                <div class="flex-shrink-0 mb-4">
                    <h2 class="text-xl font-bold">Previous Chats</h2>
                     <button id="new-chat-btn" class="w-full mt-2 bg-indigo-600 text-white p-2 rounded-md font-semibold hover:bg-indigo-700 transition-colors">New Chat</button>
                </div>
                <div id="chat-history" class="flex-grow overflow-y-auto pr-2">
                    <!-- Chat history items will be populated here -->
                </div>
                <div class="flex-shrink-0 mt-4 border-t border-gray-300 dark:border-gray-600 pt-4">
                    <p id="user-email" class="text-sm"></p>
                    <button id="logout-btn" class="w-full mt-2 bg-red-600 text-white p-2 rounded-md font-semibold hover:bg-red-700 transition-colors">Logout</button>
                </div>
            </div>

            <!-- Main Chat Window -->
            <div class="flex-1 flex flex-col bg-white dark:bg-gray-900">
                <header class="flex-shrink-0 p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                    <h1 class="text-2xl font-bold">AI Helper</h1>
                    <div class="md:hidden">
                        <button id="menu-toggle" class="text-gray-500 focus:outline-none">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                        </button>
                    </div>
                </header>
                
                <div id="chat-window" class="flex-1 flex flex-col p-4 overflow-y-hidden">
                    <div id="initial-view" class="flex-1 flex flex-col justify-center items-center text-center">
                        <h2 class="text-4xl font-bold mb-4">Hello, student.</h2>
                        <p class="text-lg text-gray-500 dark:text-gray-400">How can I help you today?</p>
                    </div>

                    <div id="chat-messages-container" class="hidden flex-1 overflow-y-auto chat-container pr-2">
                        <!-- Messages will appear here -->
                    </div>
                </div>

                <div class="flex-shrink-0 p-4 border-t border-gray-200 dark:border-gray-700">
                    <div class="flex items-center space-x-4">
                        <select id="model-selector" class="bg-gray-200 dark:bg-gray-700 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="subject">Subject Helper</option>
                            <option value="study">Study Helper</option>
                            <option value="mental">Mental Helper</option>
                        </select>
                        <div class="flex-1 relative">
                            <input id="message-input" type="text" placeholder="Send a message..." class="w-full p-3 pr-12 bg-gray-200 dark:bg-gray-700 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <button id="send-btn" class="absolute inset-y-0 right-0 px-4 text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-200">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-send"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const authScreen = document.getElementById('auth-screen');
            const chatScreen = document.getElementById('chat-screen');
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            const showSignup = document.getElementById('show-signup');
            const showLogin = document.getElementById('show-login');
            const logoutBtn = document.getElementById('logout-btn');
            const chatHistoryContainer = document.getElementById('chat-history');
            const messageInput = document.getElementById('message-input');
            const sendBtn = document.getElementById('send-btn');
            const chatMessagesContainer = document.getElementById('chat-messages-container');
            const initialView = document.getElementById('initial-view');
            const newChatBtn = document.getElementById('new-chat-btn');
            const userEmailDisplay = document.getElementById('user-email');
            const menuToggle = document.getElementById('menu-toggle');
            const sidebar = document.getElementById('sidebar');

            // Mock DB
            let db = {
                users: JSON.parse(localStorage.getItem('users')) || [],
                chats: JSON.parse(localStorage.getItem('chats')) || [],
            };

            let currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
            let activeChatId = null;

            // --- App Initialization ---
            const init = () => {
                if (currentUser) {
                    showChatScreen();
                } else {
                    showAuthScreen();
                }
            };
            
            // --- UI Management ---
            const showAuthScreen = () => {
                authScreen.style.display = 'flex';
                chatScreen.style.display = 'none';
            };

            const showChatScreen = () => {
                authScreen.style.display = 'none';
                chatScreen.style.display = 'flex';
                userEmailDisplay.textContent = currentUser.email;
                loadChatHistory();
                setActiveChat(null);
            };
            
            const toggleSidebar = () => {
                sidebar.classList.toggle('hidden');
                sidebar.classList.toggle('absolute');
                sidebar.classList.toggle('w-full');
                sidebar.classList.toggle('h-full');
            };
            
            // --- Authentication ---
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                const hashedPassword = CryptoJS.MD5(password).toString();
                const user = db.users.find(u => u.email === email && u.password === hashedPassword);
                
                const errorEl = document.getElementById('login-error');
                if (user) {
                    currentUser = user;
                    sessionStorage.setItem('currentUser', JSON.stringify(user));
                    init();
                    errorEl.classList.add('hidden');
                } else {
                    errorEl.textContent = 'Invalid email or password.';
                    errorEl.classList.remove('hidden');
                }
            });

            signupForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('signup-email').value;
                const password = document.getElementById('signup-password').value;
                const errorEl = document.getElementById('signup-error');

                if (db.users.some(u => u.email === email)) {
                    errorEl.textContent = 'User with this email already exists.';
                    errorEl.classList.remove('hidden');
                    return;
                }
                
                errorEl.classList.add('hidden');
                const newUser = {
                    id: Date.now().toString(),
                    email,
                    password: CryptoJS.MD5(password).toString()
                };
                db.users.push(newUser);
                localStorage.setItem('users', JSON.stringify(db.users));
                
                currentUser = newUser;
                sessionStorage.setItem('currentUser', JSON.stringify(newUser));
                init();
            });

            logoutBtn.addEventListener('click', () => {
                currentUser = null;
                sessionStorage.removeItem('currentUser');
                init();
            });

            showSignup.addEventListener('click', (e) => {
                e.preventDefault();
                loginForm.classList.add('hidden');
                signupForm.classList.remove('hidden');
            });

            showLogin.addEventListener('click', (e) => {
                e.preventDefault();
                signupForm.classList.add('hidden');
                loginForm.classList.remove('hidden');
            });
            
            menuToggle.addEventListener('click', toggleSidebar);

            // --- Chat Functionality ---
            
            const loadChatHistory = () => {
                chatHistoryContainer.innerHTML = '';
                const userChats = db.chats.filter(chat => chat.userId === currentUser.id);
                userChats.sort((a,b) => b.timestamp - a.timestamp).forEach(chat => {
                    const chatElement = document.createElement('div');
                    chatElement.className = 'p-2 my-1 rounded-md cursor-pointer hover:bg-gray-300 dark:hover:bg-gray-700';
                    chatElement.textContent = chat.title || `Chat from ${new Date(chat.timestamp).toLocaleDateString()}`;
                    if(chat.id === activeChatId) {
                         chatElement.classList.add('bg-indigo-200', 'dark:bg-indigo-800');
                    }
                    chatElement.addEventListener('click', () => setActiveChat(chat.id));
                    chatHistoryContainer.appendChild(chatElement);
                });
            };

            const setActiveChat = (chatId) => {
                activeChatId = chatId;
                if(chatId) {
                    const chat = db.chats.find(c => c.id === chatId);
                    if (chat) {
                        chatMessagesContainer.innerHTML = '';
                        chat.messages.forEach(msg => addMessageToUI(msg.sender, msg.text));
                        initialView.classList.add('hidden');
                        chatMessagesContainer.classList.remove('hidden');
                        chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
                    }
                } else {
                     initialView.classList.remove('hidden');
                     chatMessagesContainer.classList.add('hidden');
                     chatMessagesContainer.innerHTML = '';
                }
                loadChatHistory();
            };
            
            newChatBtn.addEventListener('click', () => {
                setActiveChat(null);
            });
            
            const handleSendMessage = () => {
                const text = messageInput.value.trim();
                if (!text) return;
                
                if (!activeChatId) {
                    const newChat = {
                        id: Date.now().toString(),
                        userId: currentUser.id,
                        title: text.substring(0, 30),
                        timestamp: Date.now(),
                        messages: []
                    };
                    db.chats.push(newChat);
                    activeChatId = newChat.id;
                }
                
                const chat = db.chats.find(c => c.id === activeChatId);
                chat.messages.push({ sender: 'user', text });
                
                addMessageToUI('user', text);
                messageInput.value = '';
                
                // Mock AI response
                setTimeout(() => {
                    const aiResponse = "AI response";
                    chat.messages.push({ sender: 'ai', text: aiResponse });
                    addMessageToUI('ai', aiResponse);
                    saveChats();
                    loadChatHistory();
                }, 1000);
            };

            sendBtn.addEventListener('click', handleSendMessage);
            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleSendMessage();
                }
            });

            const addMessageToUI = (sender, text) => {
                initialView.classList.add('hidden');
                chatMessagesContainer.classList.remove('hidden');
                
                const messageWrapper = document.createElement('div');
                messageWrapper.className = `flex mb-4 ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
                
                const messageBubble = document.createElement('div');
                messageBubble.className = `max-w-xs lg:max-w-md p-3 rounded-lg ${sender === 'user' ? 'bg-indigo-600 text-white' : 'bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100'}`;
                messageBubble.textContent = text;
                
                messageWrapper.appendChild(messageBubble);
                chatMessagesContainer.appendChild(messageWrapper);
                chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
            };

            const saveChats = () => {
                localStorage.setItem('chats', JSON.stringify(db.chats));
            };
            
            init();
        });

    </script>
</body>
</html>
